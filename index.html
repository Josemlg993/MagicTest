<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba tipo test</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px #aaa; }
    h1 { text-align: center; }
    select, button { font-size: 1em; margin: 8px 0; }
    .question { margin: 18px 0; }
    .answers label { display: block; margin: 6px 0; }
    #result { font-weight: bold; color: #007700; margin-top: 18px; }
    #error { color: #c00; margin-top: 18px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Prueba tipo test</h1>
    <label for="temaSelect">Elige un cuestionario:</label>
    <select id="temaSelect">
      <option value="">-- Selecciona un tema --</option>
      <!-- Opciones de temas generadas por JS -->
    </select>
    <button id="cargarBtn">Cargar cuestionario</button>
    <div id="quiz"></div>
    <div id="result"></div>
    <div id="error"></div>
  </div>

  <script>
    // Configuraci√≥n
    const REPO_PATH = '/MagicTest/Cuestionarios/'; // Cambia si el nombre de tu repo cambia
    const NUM_TEMAS = 10;

    // Genera las opciones de temas
    const temaSelect = document.getElementById('temaSelect');
    for (let i = 1; i <= NUM_TEMAS; i++) {
      const opt = document.createElement('option');
      opt.value = `Tema${i}`;
      opt.textContent = `Tema ${i}`;
      temaSelect.appendChild(opt);
    }

    const cargarBtn = document.getElementById('cargarBtn');
    const quizDiv = document.getElementById('quiz');
    const resultDiv = document.getElementById('result');
    const errorDiv = document.getElementById('error');

    let currentQuiz = null;

    cargarBtn.onclick = async function() {
      quizDiv.innerHTML = '';
      resultDiv.textContent = '';
      errorDiv.textContent = '';
      const tema = temaSelect.value;
      if (!tema) {
        errorDiv.textContent = 'Por favor, selecciona un tema.';
        return;
      }
      try {
        const url = location.origin + REPO_PATH + tema + '.json';
        const resp = await fetch(url);
        if (!resp.ok) throw new Error('No se pudo cargar el cuestionario.');
        const data = await resp.json();
        currentQuiz = data;
        mostrarCuestionario(data);
      } catch (e) {
        errorDiv.textContent = 'Error al cargar el cuestionario.';
      }
    };

    function mostrarCuestionario(data) {
      if (!Array.isArray(data) || data.length === 0) {
        quizDiv.innerHTML = '<p>No hay preguntas en este cuestionario.</p>';
        return;
      }
      quizDiv.innerHTML = '';
      data.forEach((pregunta, idx) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<strong>${idx + 1}. ${pregunta.pregunta}</strong>`;
        const answersDiv = document.createElement('div');
        answersDiv.className = 'answers';
        pregunta.respuestas.forEach((resp, rIdx) => {
          const id = `q${idx}_r${rIdx}`;
          answersDiv.innerHTML += `
            <label>
              <input type="radio" name="q${idx}" value="${rIdx}">
              ${resp}
            </label>
          `;
        });
        div.appendChild(answersDiv);
        quizDiv.appendChild(div);
      });
      const btn = document.createElement('button');
      btn.textContent = 'Corregir';
      btn.onclick = corregirTest;
      quizDiv.appendChild(btn);
    }

    function corregirTest() {
      let aciertos = 0;
      let total = currentQuiz.length;
      for (let i = 0; i < total; i++) {
        const radios = document.getElementsByName('q' + i);
        let selected = -1;
        for (let r = 0; r < radios.length; r++) {
          if (radios[r].checked) {
            selected = parseInt(radios[r].value);
            break;
          }
        }
        if (selected === currentQuiz[i].correcta) aciertos++;
      }
      resultDiv.textContent = `Has acertado ${aciertos} de ${total} preguntas.`;
    }
  </script>
</body>
</html>
